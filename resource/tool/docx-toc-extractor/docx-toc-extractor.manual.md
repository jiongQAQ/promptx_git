<manual>
<identity>
## 工具名称
@tool://docx-toc-extractor

## 简介
Word文档目录智能提取工具，从DOCX文件中精准提取标题结构，生成Markdown格式的目录，为AI文档处理提供结构化输入基础
</identity>

<purpose>
⚠️ **AI重要提醒**: 调用此工具前必须完整阅读本说明书，理解工具功能边界、参数要求和使用限制。禁止在不了解工具功能的情况下盲目调用。

## 核心问题定义
解决Word文档结构信息难以被AI系统直接理解和处理的问题，通过精准提取DOCX文档的标题层级结构，将其转换为机器可读的Markdown格式，为后续的文档分析、内容处理和知识提取提供清晰的结构化基础。

## 价值主张
- 🎯 **解决什么痛点**：Word文档内部结构对AI不透明，标题层级信息无法直接获取
- 🚀 **带来什么价值**：将文档骨架结构化，提升AI文档理解和处理效率
- 🌟 **独特优势**：直接解析DOCX内部XML结构，确保标题识别的准确性和完整性

## 应用边界
- ✅ **适用场景**：
  - 学术论文、技术文档、报告等有明确标题层级的DOCX文档
  - 需要快速了解文档结构和大纲的场景
  - AI文档分析的预处理阶段
  - 文档内容重组和摘要生成的准备工作
  - 跨平台文档目录显示一致性需求
  
- ❌ **不适用场景**：
  - 非DOCX格式的文档（DOC、PDF、TXT等）
  - 没有使用标准标题样式的Word文档
  - 纯文本或表格为主的文档
  - 加密或损坏的DOCX文件
</purpose>

<usage>
## 使用时机
- 📄 **文档分析前**：在对Word文档进行深度分析前，先提取结构
- 🔍 **内容理解需求**：需要快速掌握长文档的组织结构时
- 📊 **文档质量评估**：检查文档标题层级是否合理规范
- 🔄 **格式转换准备**：为文档格式转换提供结构化参考
- 📝 **摘要生成基础**：为AI生成文档摘要提供章节边界

## 操作步骤
1. **文件准备阶段**：
   - 确保目标文件为.docx格式（非.doc格式）
   - 验证文档使用了标准的标题样式（Heading1-9）
   - 检查文件路径是否正确且可访问

2. **参数配置阶段**：
   - 设置docxPath：指定Word文档的完整路径
   - 可选设置maxLevel：限制提取的最大标题层级（1-9）
   - 可选设置includeNumbers：是否保留标题中的编号
   - 可选设置outputPath：指定输出文件路径

3. **执行提取阶段**：
   - 工具自动解压DOCX文件内部结构
   - 解析document.xml中的样式信息
   - 识别并提取标题层级关系
   - 生成标准化的Markdown目录格式

4. **结果验证阶段**：
   - 检查提取的标题数量是否符合预期
   - 验证标题层级关系是否正确
   - 确认输出的Markdown格式是否规范

## 最佳实践
- 🎯 **标题规范化**：确保原文档使用标准的Heading样式，避免手动设置字体大小
- ⚠️ **层级控制**：建议设置maxLevel=6，避免过深的标题层级影响可读性
- 🔧 **编号处理**：对于有复杂编号的文档，可设置includeNumbers=false获得更清洁的标题
- 📊 **批量处理**：可结合文件遍历实现多文档批量目录提取
- 🔄 **结果验证**：提取后建议人工检查重要文档的标题完整性

## 注意事项
- **文件格式限制**：仅支持.docx格式，不支持.doc格式
- **样式依赖性**：依赖Word的标准标题样式（Heading1-9），自定义样式无法识别
- **中英文支持**：支持中英文混合文档，但复杂的多语言文档可能影响识别准确性
- **文件完整性**：确保DOCX文件完整且未损坏
- **权限要求**：需要对源文件的读取权限和输出目录的写入权限
</usage>

<parameter>
## 必需参数
| 参数名 | 类型 | 描述 | 示例 |
|--------|------|------|------|
| docxPath | string | Word文档文件的完整路径 | "/Users/doc/论文.docx" |

## 可选参数
| 参数名 | 类型 | 默认值 | 描述 |
|--------|------|--------|----------|
| outputPath | string | 自动生成 | 输出文件路径（不指定则在当前目录生成） |
| maxLevel | number | 6 | 最大标题层级（1-9） |
| includeNumbers | boolean | true | 是否保留标题编号 |

## 参数约束
- **路径格式**：docxPath必须是有效的文件路径
- **文件扩展名**：必须以.docx结尾（不区分大小写）
- **层级范围**：maxLevel必须在1-9之间
- **文件存在性**：指定的DOCX文件必须存在且可读

## 参数示例
### 基础提取示例
```json
{
  "docxPath": "/Users/documents/学术论文.docx"
}
```

### 完整配置示例
```json
{
  "docxPath": "/Users/documents/技术报告.docx",
  "outputPath": "/Users/output/报告目录.md",
  "maxLevel": 4,
  "includeNumbers": false
}
```

### 批量处理准备示例
```json
{
  "docxPath": "/Users/batch/document1.docx",
  "maxLevel": 6,
  "includeNumbers": true
}
```
</parameter>

<outcome>
## 成功返回格式
```json
{
  "success": true,
  "tocMarkdown": "- 第一章 引言\n  - 1.1 研究背景\n  - 1.2 研究目标\n- 第二章 方法\n  - 2.1 数据收集\n  - 2.2 分析方法",
  "outputFile": "/Users/output/论文_目录_20241201T143022.md",
  "headingCount": 12,
  "message": "成功提取12个标题，已保存至: /Users/output/论文_目录_20241201T143022.md"
}
```

## 错误处理格式
```json
{
  "success": false,
  "error": "文件不存在",
  "message": "无法找到文件: /Users/documents/不存在.docx"
}
```

## 特殊情况返回
```json
{
  "success": true,
  "tocMarkdown": "# 未找到标题\n\n此文档中没有找到格式化的标题。",
  "headingCount": 0,
  "message": "文档中未找到标准格式的标题"
}
```

## 结果解读指南
### 标题数量评估
- **headingCount > 0**：成功提取到标题，文档结构清晰
- **headingCount = 0**：文档可能未使用标准标题样式
- **headingCount 过多**：可能需要调整maxLevel参数

### Markdown格式说明
- **层级缩进**：使用2个空格表示每级缩进
- **标题前缀**：自动移除或保留编号（根据includeNumbers参数）
- **格式规范**：符合标准Markdown列表格式

### 输出文件命名
- **自动命名格式**：`原文件名_目录_时间戳.md`
- **时间戳格式**：YYYYMMDDTHHMMSS
- **自定义路径**：使用outputPath参数指定完整路径

## 后续动作建议
### 提取成功后
1. **结果验证**：打开生成的Markdown文件检查标题完整性
2. **结构分析**：基于提取的目录分析文档逻辑结构
3. **内容处理**：使用目录信息指导后续的文档分析任务
4. **格式优化**：根据需要调整Markdown格式或转换为其他格式

### 未找到标题时
1. **检查源文档**：确认文档是否使用了Heading1-9标题样式
2. **手动设置样式**：在Word中将标题设置为标准的标题样式
3. **调整参数**：尝试不同的maxLevel设置
4. **文档重构**：考虑对文档进行结构化重构

### 提取结果异常时
1. **文件完整性检查**：验证DOCX文件是否完整未损坏
2. **权限确认**：检查文件读取和输出目录写入权限
3. **路径验证**：确认文件路径格式正确且文件存在
4. **格式转换**：如果是.doc文件，先转换为.docx格式
</outcome>
</manual>