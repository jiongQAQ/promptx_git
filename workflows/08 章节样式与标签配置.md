# 📌 章节样式与标签配置

## 🎯 工作流目标
分两步完成章节样式配置和图表标签智能生成：
1. **工具自动化**：使用08-docx-style-enhancer工具批量添加docx_style配置
2. **AI智能标注**：AI分析章节内容，为图表生成准确的描述性标签

## 📊 配置依据
基于 `templates/docx-styles.json` 中的样式模板：
- **预设样式**：`academic` 预设提供学术论文标准格式
- **样式映射**：自动应用id、title、content等元素的样式

## 🚀 Phase 1: 工具自动配置样式

### 执行步骤
1. **预览处理效果**
```javascript
toolx("@tool://08-docx-style-enhancer", {
  "projectPath": "/当前项目绝对路径",
  "preset": "academic",
  "dryRun": true
})
```

2. **正式执行处理**
```javascript
toolx("@tool://08-docx-style-enhancer", {
  "projectPath": "/当前项目绝对路径",
  "preset": "academic",
  "backup": true
})
```

### 处理效果
为所有缺少 `docx_style` 的章节添加：
```json
{
  "docx_style": {
    "preset": "academic"
  }
}
```

## 🤖 Phase 2: AI智能图表标签生成

### 核心任务
AI需要扫描所有章节文件，识别包含图表的章节，并生成准确的描述性标签。

### 标签生成原则

#### 图片标签格式
**格式**：`图{章节号}-{序号} {具体功能描述}`

**示例**：
- `"图2-3 系统管理员用例图"`
- `"图4-2 预约创建功能时序图"`
- `"图3-1 系统软件逻辑架构图"`
- `"图5-3 数据库ER关系图"`

#### 表格标签格式
**格式**：`表{章节号}-{序号} {具体内容描述}`

**示例**：
- `"表6-1 用户认证功能测试用例表"`
- `"表4-2 系统性能指标对比表"`
- `"表2-1 功能需求分析表"`

### AI执行流程

#### Step 1: 扫描识别阶段
```javascript
// 1. 扫描所有章节文件
// 2. 识别包含以下字段的文件：
//    - imagePath: 包含图片的章节
//    - tablePath: 包含表格的章节
// 3. 统计待处理的图表数量
```

#### Step 2: 智能分析阶段
对每个包含图表的章节，AI需要分析：

**上下文分析**：
- 章节ID和标题
- 章节文本内容和主题
- 在整个论文中的位置

**文件路径分析**：
- 从imagePath/tablePath推断图表类型
- 识别关键词如：architecture、use-case、sequence、er-diagram、test等

**功能推断**：
- 结合章节主题推断图表的具体功能
- 生成准确的描述性名称

#### Step 3: 标签生成阶段

**编号规则**：
- 按章节分组：第3章的图从图3-1开始
- 章节内按imagePath出现顺序编号
- 图片和表格分别编号

**描述生成**：
- 不使用"示意图"、"流程图"等通用词
- 生成具体的功能性描述
- 体现图表在系统中的作用

#### Step 4: 标签应用阶段
为识别的章节添加标签字段：

```json
// 图片示例
{
  "id": "2.3",
  "title": "系统用例分析",
  "imagePath": "/path/to/admin-usecase.png",
  "imageLabel": "图2-3 系统管理员用例图",
  "docx_style": {
    "preset": "academic"
  }
}

// 表格示例
{
  "id": "6.1.1",
  "title": "功能测试",
  "tablePath": "/path/to/auth-test-cases.json",
  "tableLabel": "表6-1 用户认证功能测试用例表",
  "docx_style": {
    "preset": "academic"
  }
}
```

### 智能推断规则

#### 图表类型推断
从文件路径关键词推断：
```javascript
路径关键词 → 图表类型
'use-case' → '用例图'
'sequence' → '时序图' 
'architecture' → '架构图'
'er-diagram' → 'ER关系图'
'class-diagram' → '类图'
'flow' → '流程图'
'database' → '数据库设计图'
'interface' → '界面设计图'
```

#### 功能描述推断
结合章节内容推断具体功能：
```javascript
章节主题 + 图表类型 → 功能描述
'系统管理员' + '用例图' → '系统管理员用例图'
'预约创建' + '时序图' → '预约创建功能时序图'
'用户认证' + '测试表' → '用户认证功能测试用例表'
```

### 质量标准

#### 必须达到的标准
- ✅ 所有imagePath都有对应imageLabel
- ✅ 所有tablePath都有对应tableLabel  
- ✅ 标签编号连续且无重复
- ✅ 描述准确反映图表功能
- ✅ 使用学术化表达
- ✅ 避免通用性描述词

#### 标签质量检查
**好的标签示例**：
- ✅ "图3-2 用户登录功能时序图"
- ✅ "图4-1 数据库逻辑结构ER图"
- ✅ "表5-3 系统性能测试结果表"

**需要改进的标签**：
- ❌ "图3-2 时序图" → 缺少具体功能
- ❌ "图4-1 示意图" → 过于通用
- ❌ "表5-3 数据表" → 缺少内容描述

## 🔄 完整执行流程

### 执行顺序
1. **先运行Phase 1**：确保所有章节都有docx_style配置
2. **再运行Phase 2**：AI智能生成图表标签
3. **质量验证**：检查生成的标签质量
4. **手动优化**：对不准确的标签进行人工调整

### AI执行指导
当AI执行此工作流时，应该：

1. **调用08工具**完成样式配置
2. **读取所有章节文件**进行图表识别
3. **分析每个图表**的上下文和用途
4. **生成描述性标签**而非通用标签
5. **按章节编号**确保顺序正确
6. **更新JSON文件**添加标签字段
7. **报告处理结果**包括统计信息

### 成功标准
- 工具执行成功，所有章节有docx_style
- AI识别所有图表，无遗漏
- 生成的标签描述准确、具体
- 编号规则正确，无重复冲突
- JSON文件格式正确，无语法错误

## 📊 预期输出示例

```
🚀 Phase 1 完成：
- 使用08-docx-style-enhancer工具
- 处理54个章节文件
- 添加docx_style配置：54个

🤖 Phase 2 完成：
- AI识别图表章节：20个
- 生成图片标签：13个
  - 图2-3 系统管理员用例图
  - 图3-1 系统软件逻辑架构图  
  - 图4-2 预约创建功能时序图
  - ...
- 生成表格标签：7个
  - 表6-1 用户认证功能测试用例表
  - 表6-2 系统性能测试结果表
  - ...
```

此工作流确保论文章节具备完整的样式配置和准确的图表标签，为后续的Word文档生成奠定基础。